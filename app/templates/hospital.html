<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>의료 사각지대 해소 웹서비스</title>
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=cqqqjd9e72"></script>
    <link rel="stylesheet" href="../static/css/second.css">
</head>
<body>
    <h1>병원 찾기</h1>
    <form action = "" method = "post">
        <h3>지역 선택</h3>
        <select name="region1">
            <option value="1">서울특별시</option>
            <option value="2">부산광역시</option>
            <option value="3">대구광역시</option>
            <option value="4">인천광역시</option>
            <option value="5">광주광역시</option>
            <option value="6">대전광역시</option>
            <option value="7">울산광역시</option>
            <option value="8">세종특별자치시</option>
            <option value="9">경기도</option>
            <option value="10">강원도</option>
            <option value="11">충청북도</option>
            <option value="12">충청남도</option>
            <option value="13">전라북도</option>
            <option value="14">전라남도</option>
            <option value="15">경상북도</option>
            <option value="16">경상남도</option>
            <option value="17">제주특별자치도</option>
        </select><br><br>
        
        <h3>병원 분류 선택</h3>
        <input type="checkbox" name="hosp_div" value="div1"> 한의원
        <input type="checkbox" name="hosp_div" value="div2"> 한방병원
        <input type="checkbox" name="hosp_div" value="div3"> 치과의원
        <input type="checkbox" name="hosp_div" value="div4"> 치과병원<br>
        <input type="checkbox" name="hosp_div" value="div5"> 종합병원
        <input type="checkbox" name="hosp_div" value="div6"> 요양병원
        <input type="checkbox" name="hosp_div" value="div7"> 병원
        <input type="checkbox" name="hosp_div" value="div8"> 의원<br>
        <input type="checkbox" name="hosp_div" value="div9"> 보건소
        <input type="checkbox" name="hosp_div" value="div10"> 기타(구급차)
        <input type="checkbox" name="hosp_div" value="div11"> 기타<br><br>

        <input type="submit" id="search" value="검색"><br><br>
    </form>

    <span id="hospital"></span>
    <script type="text/javascript">
    var getLatLng = '{{result|default("")|tojson|safe}}';
        var result = JSON.parse(getLatLng);
        console.log(result);
        for (var i=0; i < result.length; i++) {
            var lat = parseFloat(result[i]["wgs84Lat"])
            var lon = parseFloat(result[i]["wgs84Lon"])
            console.log(lat);
            console.log(lon);
        }; 
    </script>
    
    <div id="map" style="width:60%; height: 450px"></div>
    <script type='text/javascript'>
        var mapOptions = {
            center: new naver.maps.LatLng(37.3595704, 127.105399),
            zoom: 10
    
        };
    
        var map = new naver.maps.Map('map', mapOptions);
        
        const data = [
            {
                title: "용산역",
                address: "용산",
                lat: 37.53000095823676,
                lng: 126.9647696445236,
            },
            {
                title: "서울역",
                address: "서울",
                lat: 37.55676843496512,
                lng: 126.9723863076583,
            },
        ];
    
        let markerList = [];
        let infowindowList = [];
    
        const getClickHandler = (i) => () => {
            const marker = markerList[i];
            const infowindow = infowindowList[i];
            if (infowindow.getMap()) {
                infowindow.close();
            }else{
                infowindow.open(map, marker);
            }
        };
    
        const getClickMap = (i) => () => {
            const infowindow = infowindowList[i];
            infowindow.close();
        };
    
        for (let i in data) {
            const target = data[i];
            const latlng = new naver.maps.LatLng(target.lat, target.lng);
    
            let marker = new naver.maps.Marker({
                map:map,
                position: latlng,
                icon: {
                    content: `<div class = "marker"></div>`,
                    anchor: new naver.maps.Point(7.5, 7.5),
                },
            });
    
            const content = `
                <div class = "infowindow_wrap">
                    <div class = "infowindow_title">${target.title}</div>
                    <div class = "infowindow_address">${target.address}</div>
                </div>
            `;
    
            const infowindow = new naver.maps.InfoWindow({
                content : content,
                backgroundColor : "#00ff0000",
                borderColor: "#00ff0000",
                anchorSize: new naver.maps.Size(0, 0),
            });
    
            markerList.push(marker);
            infowindowList.push(infowindow);
        };
    
        for (let i = 0, ii = markerList.length; i < ii; i++) {
            naver.maps.Event.addListener(markerList[i],"click",getClickHandler(i));
            naver.maps.Event.addListener(map,"click", getClickMap(i));
        };

    </script>
    
</body>
</html>
